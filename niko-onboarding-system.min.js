!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NikoOnboardingSystem=t():e.NikoOnboardingSystem=t()}(this,()=>(()=>{"use strict";var e={};return(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e),function(e){console.log("🚀 Loading Niko Onboarding System v1.0.0 (Standalone)");const t="https://bzjoxjqfpmjhbfijthpp.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6am94anFmcG1qaGJmaWp0aHBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3NjIyMzksImV4cCI6MjA3MTMzODIzOX0.sL9omeLIgpgqYjTJM6SGQPSvUvm5z-Yr9rOzkOi2mJk",r="/app/customer/dashboard",i="/app/retailer/dashboard",s="/app/auth/log-in";class n{constructor(){this.initialized=!1,this.currentStep=1,this.totalSteps=3,this.formData={},this.userType=null,this.supabase=null,console.log("📋 Onboarding system initializing..."),this.init()}async init(){try{e.NikoAuthCore||(console.log("⏳ Waiting for NikoAuthCore..."),await this.waitForAuth()),"undefined"==typeof supabase&&await this.loadSupabase(),this.supabase=supabase.createClient(t,o);const r=await e.NikoAuthCore.getCurrentUser();if(!r)return console.error("❌ No authenticated user found"),void(e.location.href=s);if(this.userType=r.user_metadata?.user_type||"customer",console.log("👤 User type:",this.userType),await this.checkOnboardingStatus(r.id))return console.log("✅ Onboarding already completed, redirecting to dashboard..."),void this.redirectToDashboard();this.loadProgress(),this.initialized=!0,this.setupFormHandlers(),this.setupNavigationHandlers(),this.updateProgressBar(),this.showCurrentStep(),console.log("✅ Onboarding System initialized")}catch(e){console.error("❌ Failed to initialize onboarding system:",e)}}loadSupabase(){return new Promise((e,t)=>{const o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2",o.onload=e,o.onerror=t,document.head.appendChild(o)})}waitForAuth(){return new Promise(t=>{const o=setInterval(()=>{e.NikoAuthCore&&e.NikoAuthCore.initialized&&(clearInterval(o),t())},100);setTimeout(()=>{clearInterval(o),console.error("❌ Timeout waiting for NikoAuthCore"),t()},1e4)})}async checkOnboardingStatus(e){try{console.log("🔍 Checking onboarding status for user:",e);const r=await fetch(`${t}/functions/v1/check-onboarding-status`,{method:"POST",headers:{"Content-Type":"application/json",apikey:o},body:JSON.stringify({user_id:e})}),i=await r.json();if(!r.ok||!i.success)return console.error("❌ Error checking onboarding status:",i.error),!1;const s=i.onboarding_completed||!1;return console.log("📊 Onboarding status:",s?"COMPLETED":"PENDING"),s}catch(e){return console.error("💥 Onboarding status check failed:",e),!1}}setupFormHandlers(){document.querySelectorAll("[niko-onboarding-field]").forEach(e=>{const t=e.getAttribute("niko-onboarding-field");this.formData[t]&&(e.value=this.formData[t]),e.addEventListener("change",e=>{this.formData[t]=e.target.value,this.saveProgress()}),e.addEventListener("blur",()=>{this.validateField(e)})});const e=document.querySelector('[niko-onboarding="submit"]');e&&e.addEventListener("click",e=>{e.preventDefault(),this.submitOnboarding()})}setupNavigationHandlers(){document.querySelectorAll('[niko-onboarding="next"]').forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),this.validateCurrentStep()&&this.nextStep()})}),document.querySelectorAll('[niko-onboarding="prev"]').forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),this.previousStep()})}),document.querySelectorAll("[niko-onboarding-step-indicator]").forEach(e=>{const t=parseInt(e.getAttribute("niko-onboarding-step-indicator"));e.addEventListener("click",e=>{t<=this.currentStep&&this.goToStep(t)})})}validateField(e){e.getAttribute("niko-onboarding-field");const t=e.hasAttribute("required"),o=e.type;let r=!0,i="";if(t&&!e.value.trim())r=!1,i="This field is required";else if("email"===o&&e.value)/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value)||(r=!1,i="Please enter a valid email address");else if("url"===o&&e.value)try{new URL(e.value)}catch{r=!1,i="Please enter a valid URL"}const s=e.parentElement.querySelector('[niko-onboarding="error"]');return s&&(s.textContent=i,s.style.display=r?"none":"block"),r?e.classList.remove("niko-error"):e.classList.add("niko-error"),r}validateCurrentStep(){const e=document.querySelector(`[niko-onboarding-step="${this.currentStep}"]`);if(!e)return!0;const t=e.querySelectorAll("[niko-onboarding-field][required]");let o=!0;return t.forEach(e=>{this.validateField(e)||(o=!1)}),o||this.showNotification("Please fill in all required fields","error"),o}nextStep(){this.currentStep<this.totalSteps&&(this.hideStep(this.currentStep),this.currentStep++,this.showStep(this.currentStep),this.updateProgressBar(),this.saveProgress())}previousStep(){this.currentStep>1&&(this.hideStep(this.currentStep),this.currentStep--,this.showStep(this.currentStep),this.updateProgressBar())}goToStep(e){e>=1&&e<=this.totalSteps&&e!==this.currentStep&&(this.hideStep(this.currentStep),this.currentStep=e,this.showStep(this.currentStep),this.updateProgressBar())}showStep(e){const t=document.querySelector(`[niko-onboarding-step="${e}"]`);t&&(t.style.display="block",t.classList.add("niko-active"))}hideStep(e){const t=document.querySelector(`[niko-onboarding-step="${e}"]`);t&&(t.style.display="none",t.classList.remove("niko-active"))}showCurrentStep(){document.querySelectorAll("[niko-onboarding-step]").forEach(e=>{e.style.display="none",e.classList.remove("niko-active")}),this.showStep(this.currentStep)}updateProgressBar(){const e=this.currentStep/this.totalSteps*100,t=document.querySelector('[niko-onboarding="progress-bar"]');t&&(t.style.width=`${e}%`);const o=document.querySelector('[niko-onboarding="progress-text"]');o&&(o.textContent=`Step ${this.currentStep} of ${this.totalSteps}`),document.querySelectorAll("[niko-onboarding-step-indicator]").forEach((e,t)=>{const o=t+1;e.classList.remove("niko-completed","niko-active","niko-pending"),o<this.currentStep?e.classList.add("niko-completed"):o===this.currentStep?e.classList.add("niko-active"):e.classList.add("niko-pending")})}async submitOnboarding(){if(console.log("📤 Submitting onboarding data..."),!this.validateAllFields())return void this.showNotification("Please complete all required fields","error");const r=document.querySelector('[niko-onboarding="submit"]'),i=r?.textContent;r&&(r.textContent="Submitting...",r.disabled=!0);try{if(!await e.NikoAuthCore.getCurrentUser())throw new Error("User not authenticated");const{data:{session:r}}=await e.NikoAuthCore.supabase.auth.getSession();if(!r)throw new Error("No active session");const i=await fetch(`${t}/functions/v1/complete-onboarding`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`,apikey:o},body:JSON.stringify(this.formData)}),s=await i.json();if(!i.ok||!s.success)throw new Error(s.error||"Failed to complete onboarding");console.log("✅ Onboarding completed successfully!"),this.showNotification("Onboarding completed! Redirecting to dashboard...","success"),this.clearProgress(),setTimeout(()=>{this.redirectToDashboard()},2e3)}catch(e){console.error("❌ Onboarding submission failed:",e),this.showNotification(e.message||"Failed to complete onboarding","error"),r&&(r.textContent=i,r.disabled=!1)}}validateAllFields(){const e=document.querySelectorAll("[niko-onboarding-field][required]");let t=!0;return e.forEach(e=>{this.validateField(e)||(t=!1)}),t}saveProgress(){try{localStorage.setItem("niko_onboarding_progress",JSON.stringify({step:this.currentStep,data:this.formData,timestamp:Date.now()})),console.log("💾 Progress saved")}catch(e){console.error("Failed to save progress:",e)}}loadProgress(){try{const e=localStorage.getItem("niko_onboarding_progress");if(e){const t=JSON.parse(e);if(Date.now()-t.timestamp<864e5)return this.currentStep=t.step||1,this.formData=t.data||{},console.log("📂 Progress loaded:",{step:this.currentStep,fields:Object.keys(this.formData).length}),!0}}catch(e){console.error("Failed to load progress:",e)}return!1}clearProgress(){try{localStorage.removeItem("niko_onboarding_progress"),console.log("🗑️ Progress cleared")}catch(e){console.error("Failed to clear progress:",e)}}showNotification(e,t="info"){let o=document.querySelector('[niko-onboarding="notification"]');o||(o=document.createElement("div"),o.setAttribute("niko-onboarding","notification"),o.style.cssText="\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          padding: 16px 24px;\n          border-radius: 8px;\n          z-index: 9999;\n          transition: opacity 0.3s;\n          max-width: 300px;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n        ",document.body.appendChild(o));const r={success:"background: #10b981; color: white; border: 1px solid #059669;",error:"background: #ef4444; color: white; border: 1px solid #dc2626;",info:"background: #3b82f6; color: white; border: 1px solid #2563eb;"};o.style.cssText+=r[t]||r.info,o.textContent=e,o.style.display="block",o.style.opacity="1",setTimeout(()=>{o.style.opacity="0",setTimeout(()=>{o.style.display="none"},300)},5e3)}redirectToDashboard(){const t="retailer"===this.userType?i:r;console.log("🔄 Redirecting to dashboard:",t),e.location.href=e.location.origin+t}getCurrentStep(){return this.currentStep}getTotalSteps(){return this.totalSteps}getFormData(){return{...this.formData}}setFormData(e){this.formData={...this.formData,...e},this.saveProgress()}reset(){this.currentStep=1,this.formData={},this.clearProgress(),this.showCurrentStep(),this.updateProgressBar()}}function a(){e.NikoOnboardingSystem?console.log("⚠️ Onboarding system already initialized"):(e.NikoOnboardingSystem=new n,e.nikoOnboarding={nextStep:()=>e.NikoOnboardingSystem?.nextStep(),previousStep:()=>e.NikoOnboardingSystem?.previousStep(),submit:()=>e.NikoOnboardingSystem?.submitOnboarding(),reset:()=>e.NikoOnboardingSystem?.reset(),getCurrentStep:()=>e.NikoOnboardingSystem?.getCurrentStep(),getFormData:()=>e.NikoOnboardingSystem?.getFormData()})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a(),console.log("✅ Niko Onboarding System loaded - Available as window.NikoOnboardingSystem")}(window),e})());